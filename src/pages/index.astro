---
import { desc } from "drizzle-orm";
import AppHeader from "~/components/astro/app-header.astro";
import Dashboard from "~/components/features/dashboard";
import { createDb } from "~/server/db";
import { lists } from "~/server/db/schema";
import Layout from "../layouts/Layout.astro";

const db = createDb(Astro.locals.runtime.env.DB);
const recentLists = await db
	.select()
	.from(lists)
	.orderBy(desc(lists.createdAt))
	.limit(3);
---

<Layout title="Dashboard">
  <AppHeader title="Dashboard" />

  <Dashboard lists={recentLists} origin={Astro.url.origin} client:load />
</Layout>
