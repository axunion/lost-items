---
import { desc, eq } from "drizzle-orm";
import AppHeader from "~/components/astro/app-header.astro";
import RegisterPage from "~/components/features/register-page";
import { createDb } from "~/server/db";
import { items, lists } from "~/server/db/schema";
import Layout from "../../layouts/Layout.astro";

const { id = "" } = Astro.params;
const db = createDb(Astro.locals.runtime.env.DB);

const list = await db.select().from(lists).where(eq(lists.id, id)).get();
if (!list) {
	return Astro.redirect("/");
}

const itemList = await db
	.select()
	.from(items)
	.where(eq(items.listId, id))
	.orderBy(desc(items.createdAt));

const title = list.name || "Register Item";
---

<Layout title={title}>
  <AppHeader title={title} />

  <RegisterPage listId={id} items={itemList} client:load />
</Layout>
