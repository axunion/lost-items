---
import { eq } from "drizzle-orm";
import RoomManager from "~/components/features/room-manager";
import { createDb } from "~/server/db";
import { lists } from "~/server/db/schema";
import Layout from "../../layouts/Layout.astro";

const { id = "" } = Astro.params;
const origin = Astro.url.origin;
const db = createDb(Astro.locals.runtime.env.DB);

const list = await db.select().from(lists).where(eq(lists.id, id)).get();
if (!list) {
	return Astro.redirect("/");
}

const initialName = list.name || "Untitled Room";
---

<Layout title={initialName}>
  <RoomManager client:load id={id} origin={origin} initialName={initialName} />
</Layout>
